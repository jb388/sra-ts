---
title: "Parent material and climate interact to control soil carbon dynamics on timescales from years to centuries"
author: J. Beem-Miller
date: \textit{\today}
output:
  pdf_document:
    latex_engine: xelatex
    toc: yes
    toc_depth: 3
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '2'
  html_notebook:
    css: "custom.css"
    toc: yes
    toc_depth: 2
header_includes:
- \usepackage[utf8]{inputenc}
- \usepackage{float}
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
                      fig.align = 'center', dev = c('cairo_pdf', 'png'), 
                      fig.width = 6.5,
                      fig.height = 3.5)
options(scipen = 5)
# load page breaks fx
source("./utilities/page_break_Rmd.R")
```

```{r setup, include = FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(SoilR)
library(openxlsx)
library(ISRaD)
library(lme4)
library(lmerTest)
library(emmeans)
library(gt)
library(scales)
library(corrplot)
```

```{r plot-funs}
# color palettes for ECO & PM
warm <- "#BF812D"
cool <- "#80CDC1"
cold <- "#01665E"
granite <- "#9daba9"
andesite <- "#382dbf"
basalt <- "#bf382d"

# emmimp plots
emmip.plot.fx <- function(lyr_bot, Type, var, interact_var = NULL, key.pos = "right") {
  
  # get data, set limits, and define ylab
  if (Type == "Bulk") {
    data <- sra.01.09.19.d.df[sra.01.09.19.d.df$lyr_bot == lyr_bot, ]
    yLab <- expression(Delta*''^14*'C (‰)')
    brks <- c(2001, 2009, 2019)
    shp <- 16
  } else {
    data <- sra.01.19.inc.d.df[sra.01.19.inc.d.df$lyr_bot == lyr_bot, ]
    yLab <- expression(Delta*''^14*'C-CO'[2]*' (‰)')
    brks <- c(2001, 2019)
    shp <- 1
  }
  
  # model
  mod <- lm(d14c ~ PM * Year * ECO, data)
  
  # set scales
  if (var == "PM") {
    nm <- "Parent material"
    vals <- c("andesite" = andesite, "basalt" = basalt, "granite" = granite)
  } else {
    nm <- "Climate"
    vals <- c("warm" = warm, "cool" = cool, "cold" = cold)
  }
  
  # define depth and var
  depth <- ifelse(lyr_bot == 10, "0-10cm", ifelse(lyr_bot == 20, "10-20cm", "20-30cm"))
  quo_var <- sym(var)
  quo_var_f <- ifelse(var == "PM", sym("ECO"), sym("PM"))
  
  # run emmip
  if (is.null(interact_var)) {
    if (var == "PM") {
      df <- emmip(mod, PM ~ Year, CIs = TRUE, at = list(Year = brks))$data 
    } else {
      df <- emmip(mod, ECO ~ Year, CIs = TRUE, at = list(Year = brks))$data
    }
  } else {
    if (var == "PM") {
      df <- emmip(mod, PM ~ Year | ECO, CIs = TRUE, at = list(Year = brks))$data
    } else {
      df <- emmip(mod, ECO ~ Year | PM, CIs = TRUE, at = list(Year = brks))$data
    }
  }
  ggplot(df, aes(xvar, yvar)) +
    geom_line(data = atm.14c, aes(Year, d14c, linetype = atm), color = "black") +
    geom_line(aes(color = !! quo_var), size = 1.5) +
    geom_ribbon(aes(ymin = LCL, ymax = UCL, fill = !! quo_var), alpha = .1) +
    geom_point(data = data, aes(Year, d14c, color = !! quo_var), 
               shape = shp, size = 2, alpha = .8) +
    scale_linetype_manual(name = NULL, 
                          values = c("atmosphere" = 3)) +
    scale_color_manual(name = NULL,
                       values = vals) +
    scale_fill_manual(name = NULL,
                      values = vals) +
    scale_x_continuous(limits = c(2000, 2020), 
                       breaks = brks, expand = expansion(add = 2)) +
    coord_cartesian(ylim = c(-190, 170)) +
    ylab(yLab) +
    ggtitle(paste(Type, depth, sep = ", ")) +
    facet_grid(cols = vars(!! quo_var_f)) +
    theme_bw() +
    theme(panel.grid = element_blank(),
          plot.title = element_text(hjust = 0.5),
          axis.title.x = element_blank(),
          text = element_text(size = 14),
          legend.position = key.pos)
}
```

```{r atm-14c}
load("atm.14c.RData")
atm.14c <- atm.14c %>% rename(Year = year) %>% mutate(atm = "atmosphere")
```

```{r load-min}
load("ras18.sp.df.RData")
```

```{r bulk-data-wrangling}
# load data
load("sra.19.01.09.RData")
load("sra.19.01.rep.ls.RData")
load("sra.2019.ls.RData")

## change over time
# merge '01 and '19 data
sra.19.01.d <- merge(sra.19.01.09[sra.19.01.09$Year == 2001 & sra.19.01.09$lyr_bot, ],
                     sra.19.01.09[sra.19.01.09$Year == 2019 & sra.19.01.09$lyr_bot < 31, ],
                     by = c("PM", "ECO", "PMeco", "lyr_top", "lyr_bot"),
                     suffixes = c("_01", "_19")) 
sra.19.01.d$dd14c_01_19 <- sra.19.01.d$d14c_01 - sra.19.01.d$d14c_19
sra.19.01.d$sd14c_01_19 <- sqrt(sra.19.01.d$d14c_sd_01^2/3 + sra.19.01.d$d14c_sd_19^2/3)

## summarize change '01-'19
# PM
sra.19.01.dsum.PM <-
  sra.19.01.d %>%
  filter(lyr_bot < 31) %>%
  group_by(PM, lyr_bot) %>%
  summarize(across(dd14c_01_19, .fn = list(mean = mean, sd = sd), na.rm = TRUE))
# ECO
sra.19.01.dsum.ECO <-
  sra.19.01.d %>%
  filter(lyr_bot < 31) %>%
  group_by(ECO, lyr_bot) %>%
  summarize(across(dd14c_01_19, .fn = list(mean = mean, sd = sd), na.rm = TRUE))

## make long data frame of rep data
# 2001 = sra.19.01.rep.ls (splined to '19 depths)
sra.19.01.rep.df <- bind_rows(lapply(sra.19.01.rep.ls, function(PMeco) {
  df <- bind_rows(lapply(PMeco, function(r) {
    fm <- r[!is.na(r)]
    lyr_bot <- seq(10, length(fm) * 10, by = 10)
    return(data.frame(fm = fm, lyr_bot = lyr_bot))
    }), .id = "PMeco_rep")
  df$pro_rep <- substr(df$PMeco_rep, nchar(df$PMeco_rep), nchar(df$PMeco_rep))
  return(df[ , c("fm", "lyr_bot", "pro_rep")])
}), .id = "PMeco")
sra.19.01.rep.df$Year <- 2001
sra.19.01.rep.df$PM <- substr(sra.19.01.rep.df$PMeco, 1, 2)
sra.19.01.rep.df$ECO <- substr(sra.19.01.rep.df$PMeco, 3, 4)
# 2019 = sra.2019.ls
sra.2019.rep.df <- bind_rows(sra.2019.ls, .id = "PMeco")
sra.2019.rep.df <- sra.2019.rep.df[sra.2019.rep.df$lyr_bot < 31, ]

# 2009 (splined to '19 depths)
sra.09.19.df <- sra.19.01.09[sra.19.01.09$Year == "2009", 
                             c("PMeco", "fm", "lyr_bot", "Year", "PM", "ECO")] %>%
  mutate(pro_rep = 1) %>%
  filter(lyr_bot < 31)

# merge
sra.01.09.19.d.df <- rbind(
  sra.2019.rep.df[ , match(names(sra.19.01.rep.df), names(sra.2019.rep.df))],
  sra.09.19.df,
  sra.19.01.rep.df) %>%
  left_join(., ras18.sp.df[ , c("Al_ox", "Al_py", "Fe_dc", "Fe_ox", "lyr_bot", "PM", "ECO")], 
  by = c("lyr_bot", "PM", "ECO")) %>%
  mutate(PM = factor(recode(PM, `AN` = "andesite", `BS` = "basalt", `GR` = "granite")),
         ECO = factor(recode(ECO, `pp` = "warm", `wf` = "cool", `rf` = "cold"),
                      levels = c("warm", "cool", "cold")),
         year = as.numeric(Year) - 2000,
         Year = as.numeric(Year))
sra.01.09.19.d.df$d14c <- convert_fm_d14c(fm = sra.01.09.19.d.df$fm,
                                          obs_date_y = sra.01.09.19.d.df$Year, verbose = FALSE)

# by depth
sra.01.09.19.d.10df <- sra.01.09.19.d.df[sra.01.09.19.d.df$lyr_bot == 10, ]
sra.01.09.19.d.20df <- sra.01.09.19.d.df[sra.01.09.19.d.df$lyr_bot == 20, ]
sra.01.09.19.d.30df <- sra.01.09.19.d.df[sra.01.09.19.d.df$lyr_bot == 30, ]
```

```{r resp-data-wrangling}
# load data
load("sra.19.01.inc.df.RData")
load("sra.2019.inc.df.RData")
load("sra.2001.inc.df2.RData")
load("sra.2019.inc.df2.RData")

# rbind '01 and '19 data
sra.01.19.inc.d.df <- rbind(cbind(sra.2001.inc.df2, 
                                  rep = rep(c("a", "b"), each = 27),
                                  Year = 2001),
                            sra.2019.inc.df2[ , c("PM", "ECO", "rep", "lyr_bot", "Year", "d14c")]) %>%
  left_join(., ras18.sp.df[ , c("Al_ox", "Al_py", "Fe_dc", "Fe_ox", "lyr_bot", "PM", "ECO")], 
  by = c("lyr_bot", "PM", "ECO")) %>%
  mutate(PM = factor(recode(PM, `AN` = "andesite", `BS` = "basalt", `GR` = "granite")),
         ECO = factor(recode(ECO, `pp` = "warm", `wf` = "cool", `rf` = "cold"),
                      levels = c("warm", "cool", "cold")),
         year = Year - 2000)

## change over time
# merge '01 and '19 data
sd.inc.fx <- function(df) {
  apply(df[ , c("d14c_min", "d14c_max")], 1, sd)
}
sra.19.01.inc.d.df <- merge(
  cbind(sra.19.01.inc.df, sd = sd.inc.fx(sra.19.01.inc.df))[ , c("PM", "ECO", "PMeco", "lyr_bot", "d14c", "sd")],
  cbind(sra.2019.inc.df, sd = sd.inc.fx(sra.2019.inc.df))[ , c("PM", "ECO", "PMeco", "lyr_bot", "d14c", "sd")],
  by = c("PM", "ECO", "PMeco", "lyr_bot"),
  suffixes = c("_01", "_19"))
sra.19.01.inc.d.df$dd14c_01_19 <- sra.19.01.inc.d.df$d14c_01 - sra.19.01.inc.d.df$d14c_19
sra.19.01.inc.d.df$sd14c_01_19 <- sqrt(
  sra.19.01.inc.d.df$sd_01^2/2 + sra.19.01.inc.d.df$sd_19^2/2)

## filter outliers
sra.01.19.inc.d.df <- sra.01.19.inc.d.df[-which(sra.01.19.inc.d.df$d14c < -200), ]

# df by depth
sra.01.19.inc.d.10.df <- sra.01.19.inc.d.df[sra.01.19.inc.d.df$lyr_bot == 10, ]
sra.01.19.inc.d.20.df <- sra.01.19.inc.d.df[sra.01.19.inc.d.df$lyr_bot == 20, ]
sra.01.19.inc.d.30.df <- sra.01.19.inc.d.df[sra.01.19.inc.d.df$lyr_bot == 30, ]
```

# Introduction

*	Climate and parent material are key factors known to affect the accrual and decomposition of soil organic matter on time scales of centuries to millenia
  * Effect on short term soil C dynamics not well understood
*	Soil organic matter is heterogeneous: a mix of fast and slow cycling components
* Understanding both slow and fast dynamics is essential for understanding and modeling how soil C stocks and fluxes may shift under climate change
* This study is concerned with how these factors interact to control soil C dynamics on annual to centennial time scales
  
*	The effect of climate is on long term soil organic matter persistence is well-known from global scale and longitudinal studies: larger stocks of soil C are observed in regions with colder temperature regimes or with extremes of moisture, i.e. arid conditions or wet, saturated soils (Shi et al., 2020, etc.)
* The development and persistence of poorly crystalline secondary minerals, derived from parent materials through weathering, are also associated with long term soil C persistence
  * As climate and parent material interact on geologic timescales, weathering leads to formation of poorly crystalline minerals but eventually to degradation of these minerals over time
  * E.g. most depleted ^14^C content of soil organic matter associated with intermediate weathering stages of soil development (Hawaii chronosequence studies)

* Over a century of laboratory studies demonstrate that temperature exerts a direct control over decomposition rates (given appropriate moisture conditions)
* This suggests that temperature plays a key role in the determining cycling rates of unprotected soil C
* In contrast, the role of mineral-organic associations in controlling short term soil C cycling is poorly understood
* There is evidence that the content of Fe and Al oxyhydroxides and Al coordinated organo-mineral complexes is associated with reduced soil C mineralization rates (Rasmussen et al., 2006)
* This seems to indicate that a larger proportion of soil organic matter is protected from decomposition when these these poorly crystalline minerals and organo-mineral complexes are present as compared to a soil with the same amount of organic matter but a lower concentration of these minerals
* However, the degree to which this protected C cycles at annual to decadal scales is unknown

* The $\Delta$^14^C signal of bulk soil organic matter in the top 30 cm reflects the contribution of relatively stable C, assumed to be cycling on centennial time scales or longer (Shi et al., 2020)
* In contrast, observations of $\Delta$^14^C-CO~2~ from the top 30 cm suggests that much of the carbon that enters the soil leaves again relatively quickly, cycling on annual to decadal time scales (Trumbore, 2000)
* The difference between these two measurements can be used as an indicator for the heterogeneity of the soil C reservoir
  * If bulk soil $\Delta$^14^C is the same as $\Delta$^14^C-CO~2~ it suggests that the soil C pool is homogenous, and can be modeled as a single pool
  * A large difference between these two measurements indicates the presence of a persistent soil C pool that does not contribute substantially to respiration

* The ability to detect change in bulk soil $\Delta$^14^C over time depends on the spatial heterogeneity of soil organic matter, distribution of soil C between protected and microbially available forms, the magnitude of annual carbon fluxes relative to the stock of existing soil C, and the change in the $\Delta$^14^C signal of the atmosphere over the period of time in question
* Atmospheric $\Delta$^14^C has declined at a near linear rate of approximately 5 per mille over the first two decades of the 20th century, providing a baseline for the detection of change in annually cycling soil C
 * The uncertainty of ^14^C measurements due to spatial heterogeneity of soil organic matter can be determined by collecting replicate soil profiles from the same site at a single point in time


*[perhaps show C stocks for context for ^14^C trends?]*

# Hypotheses

1. Parent material will explain more of the variance in bulk soil $\Delta$^14^C than climate, because parent material controls $\Delta$^14^C of the slow cycling soil C that dominates the bulk $\Delta$^14^C signal.
2. Climate will explain more of the variance in respired soil $\Delta$^14^C-CO~2~ than parent material, as climate controls $\Delta$^14^C of the fast cycling soil C that dominates the respired $\Delta$^14^C-CO~2~ signal.
3. The difference between bulk soil $\Delta$^14^C and $\Delta$^14^C-CO~2~ will be greatest in the soils with the highest concentration of Al and Fe extractable from poorly crystalline minerals.  
4. Change in bulk soil $\Delta$^14^C over time will be greatest in soils developed on granite soils and least in soils developed on andesite (GR > BS > AN), due to the effect of parent material on the turnover rate of persistent soil C.

# Methods

I constructed linear models for $\Delta$^14^C of bulk soil C and heterotrophically respired CO~2~ as function of parent material (PM), climate (CL), and year. I considered both the two-way and three-way interactions, using models of the form: lm(d14c ~ PM * CL * year). Prior to modeling I interpolated the 2001 and 2009 $\Delta$^14^C data to the 2019 sampling depths using a mass-preserving spline weighted by carbon stocks. In order to simplify the analysis and focus on the change in $\Delta$^14^C over time as a function of parent material and climate, I modeled each depth increment separately. I focused on the top 30cm only (i.e. 0-10cm, 10-20cm, and 20-30cm depth increments) owing to a lack of data from the 2001 sampling for depths below this depth. 

`r pagebreak()`

# Results
## Depth profiles

>**Fig. `r {(fig.n <- 1)}`. Depth profiles of $\Delta$^14^C of bulk soil and respired CO~2~**

> Bulk soil points show the mean of three replicate profiles. We composited the profile replicates prior to incubation, and respired data points show the mean of laboratory duplicates. Error bars show ±1 SD for bulk soils and the min. and max. for respired CO~2~. Respired CO~2~ from the cold granite soil was extremely depleted in $\Delta$^14^C and thus is excluded for display purposes.

```{r bulk-inc-plot-data, fig.height = 6}
# 2019
load("sra.19.inc.blk.RData")
# 2001
load("sra.01.inc.blk.RData")

## plot
# 2019
# sra.19.inc.blk %>%
#   mutate(ECOtype = paste0(eco, " (", Type, ")")) %>%
#   arrange(lyr_bot) %>%
#   ggplot(., aes(d14c_mean, lyr_bot, color = pm, shape = ECOtype, linetype = Type)) +
#   geom_vline(xintercept = atm.d14.2019) +
#   geom_hline(yintercept = 0) +
#   geom_point(size = 3) +
#   geom_errorbarh(
#     aes(xmin = d14c_l,
#         xmax = d14c_u,
#         color = pm),
#     height = 1.5) +
#   geom_path() +
#   scale_y_reverse() +
#   scale_color_manual(name = "Parent material",
#                      values = c("andesite" = andesite,
#                                 "basalt" = basalt,
#                                 "granite" = granite)) +
#   scale_shape_manual(name = "Ecosystem (type)",
#                      values = c("warm (bulk)" = 15,
#                                 "cool (bulk)" = 16,
#                                 "cold (bulk)" = 17,
#                                 "warm (inc)" = 0,
#                                 "cool (inc)" = 1,
#                                 "cold (inc)" = 2)) +
#   xlab(expression(Delta*''^14*'C (‰)')) +
#   ylab("Depth (cm)") +
#   facet_grid(rows = vars(eco), cols = vars(pm)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank())

# 2001
# sra.01.inc.blk %>%
#   mutate(ECOtype = paste0(eco, " (", Type, ")")) %>%
#   ggplot(., aes(d14c_mean, lyr_bot, color = pm, shape = ECOtype, linetype = Type)) +
#   geom_vline(xintercept = atm.d14.2001) +
#   geom_hline(yintercept = 0) +
#   geom_point(size = 3) +
#   geom_errorbarh(
#     aes(xmin = d14c_l, 
#         xmax = d14c_u,
#         color = pm), 
#     height = 1.5) +
#   geom_path() +
#   scale_y_reverse() +
#   scale_color_manual(name = "Parent material",
#                      values = c("andesite" = andesite, 
#                                 "basalt" = basalt, 
#                                 "granite" = granite)) +
#   scale_shape_manual(name = "Ecosystem (type)",
#                      values = c("warm (bulk)" = 15, 
#                                 "cool (bulk)" = 16, 
#                                 "cold (bulk)" = 17,
#                                 "warm (inc)" = 0, 
#                                 "cool (inc)" = 1, 
#                                 "cold (inc)" = 2)) +
#   scale_x_continuous(limits = c(-100, 200)) +
#   xlab(expression(Delta*''^14*'C (‰)')) +
#   ylab("Depth (cm)") +
#   facet_grid(rows = vars(eco), cols = vars(pm)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank())

# both
sra.01.inc.blk %>%
  rbind(., sra.19.inc.blk) %>%
  mutate(Type = ifelse(Type == "inc", "respired", "bulk soil")) %>%
  mutate(ECOtype = paste0(eco, " (", Type, ")")) %>%
  filter(lyr_bot > 0) %>%
  ggplot(., aes(d14c_mean, lyr_bot, color = pm, shape = ECOtype, linetype = ECOtype)) +
  geom_vline(xintercept = 0) +
  geom_hline(yintercept = 0) +
  geom_point(size = 3) +
  geom_errorbarh(
    aes(xmin = d14c_l, 
        xmax = d14c_u,
        color = pm), 
    height = 1.5) +
  geom_path() +
  scale_y_reverse() +
  scale_color_manual(name = "Parent material",
                     values = c("andesite" = andesite, 
                                "basalt" = basalt, 
                                "granite" = granite)) +
  scale_shape_manual(name = "Climate (type)",
                     values = c("warm (bulk soil)" = 15, 
                                "cool (bulk soil)" = 16, 
                                "cold (bulk soil)" = 17,
                                "warm (respired)" = 0, 
                                "cool (respired)" = 1, 
                                "cold (respired)" = 2)) +
  scale_linetype_manual(name = "Climate (type)",
                        values = c("warm (bulk soil)" = 1, 
                                   "cool (bulk soil)" = 1, 
                                   "cold (bulk soil)" = 1,
                                   "warm (respired)" = 2, 
                                   "cool (respired)" = 2, 
                                   "cold (respired)" = 2)) +
  coord_cartesian(
    xlim = c(-100, 200), 
    ylim = c(43, 0),
    expand = FALSE) +
  scale_x_continuous(breaks = c(-50, 0, 50, 150)) +
  xlab(expression(Delta*''^14*'C (‰)')) +
  ylab("Depth (cm)") +
  facet_grid(rows = vars(Year), cols = vars(eco)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank())

# # plot time series in same panel, with type as layout and splined depths
# # both
# sra.ts.all %>%
#   filter(year != 2009) %>%
#   filter(lyr_bot > 0) %>%
#   mutate(Type = ifelse(Type == "inc", "respired", "bulk soil")) %>%
#   mutate(ecoYear = paste0(eco, " (", year, ")")) %>%
#   ggplot(., aes(d14c, lyr_bot, color = pm, shape = ecoYear, linetype = ecoYear)) +
#   geom_vline(xintercept = 0) +
#   geom_hline(yintercept = 0) +
#   geom_point(size = 3) +
#   geom_errorbarh(
#     aes(xmin = d14c_l,
#         xmax = d14c_u,
#         color = pm),
#     height = .7) +
#   geom_path() +
#   scale_y_reverse() +
#   scale_color_manual(name = "Parent material",
#                      values = c("andesite" = andesite,
#                                 "basalt" = basalt,
#                                 "granite" = granite)) +
#   scale_shape_manual(name = "Ecosystem (type)",
#                      values = c("warm (2001)" = 15,
#                                 "cool (2001)" = 16,
#                                 "cold (2001)" = 17,
#                                 "warm (2019)" = 0,
#                                 "cool (2019)" = 1,
#                                 "cold (2019)" = 2)) +
#   scale_linetype_manual(name = "Ecosystem (type)",
#                         values = c("warm (2001)" = 1,
#                                    "cool (2001)" = 1,
#                                    "cold (2001)" = 1,
#                                    "warm (2019)" = 2,
#                                    "cool (2019)" = 2,
#                                    "cold (2019)" = 2)) +
#   coord_cartesian(
#     xlim = c(-100, 200),
#     ylim = c(32, 8),
#     expand = FALSE) +
#   scale_x_continuous(breaks = c(-50, 0, 50, 150)) +
#   xlab(expression(Delta*''^14*'C (‰)')) +
#   ylab("Depth (cm)") +
#   facet_grid(rows = vars(Type), cols = vars(eco)) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank())
```

## ANOVA
### Bulk soil

```{r models-blk-sum-con, include = FALSE}
# 0-10
blk.PMeco.10.lm <- lm(d14c ~ PM * ECO * year, sra.01.09.19.d.10df)
summary(blk.PMeco.10.lm)
blk.PMeco.10.et <- emtrends(blk.PMeco.10.lm, pairwise ~ PM * ECO, var = "year")
# ordered trends
# c(-6.1, -5, -2.8, -2.3, -2.1, -1.9, -.3, .1, .8)

# 10-20
blk.PMeco.20.lm <- lm(d14c ~ PM * ECO * year, sra.01.09.19.d.20df)
summary(blk.PMeco.20.lm)
blk.PMeco.20.et <- emtrends(blk.PMeco.20.lm, pairwise ~ PM * ECO, var = "year")
# ordered trends
# c(-3.7, -3.7, -2.1, -1.1, -.3, -.2, .42, .43, 2.1)

# 20-30
blk.PMeco.30.lm <- lm(d14c ~ PM * ECO * year, sra.01.09.19.d.30df)
summary(blk.PMeco.30.lm)
blk.PMeco.30.et <- emtrends(blk.PMeco.30.lm, pairwise ~ PM * ECO, var = "year")
# ordered trends
# c(-6.4, -3.6, -1, .2, .3, .3, .3, 1.1, 1.6)
```

Both parent material and climate are significant factors for explaining the variance in bulk soil $\Delta$^14^C at all depths (Table 1, Table 2, Table 3). Climate explains more of the variance at the surface (0-10cm) than does parent material (`r round(anova(blk.PMeco.10.lm)[["Sum Sq"]][2]/sum(anova(blk.PMeco.30.lm)[["Sum Sq"]])*100,1)`% and `r round(anova(blk.PMeco.10.lm)[["Sum Sq"]][1]/sum(anova(blk.PMeco.30.lm)[["Sum Sq"]])*100,1)`%, for climate and parent material, respectively) (Table 1). Below 10cm in depth the relative importance of these two factors reverses, with parent material explaining more variance than climate (Table 2). At the deepest depth (20-30cm) parent material explains `r round(anova(blk.PMeco.30.lm)[["Sum Sq"]][1]/sum(anova(blk.PMeco.30.lm)[["Sum Sq"]])*100,1)`% of variance in bulk soil $\Delta$^14^C compared to `r round(anova(blk.PMeco.30.lm)[["Sum Sq"]][2]/sum(anova(blk.PMeco.30.lm)[["Sum Sq"]])*100, 1)`% for climate (Table 3). The two-way interaction between parent material and climate is signficant in the top 20cm (*p* < 0.05), but not at the deepest depth.

Year is highly significant at the surface (*p* < 0.0001, Table 1), but is only marginally significant in the deeper soil layers (*p* < 0.10) (Table 2, Table 3). Interestingly, the two-way interaction between climate and year is much more significant than the interaction between parent material and year at all depths. This appears to be driven by the strong decrease in cool site $\Delta$^14^C over time relative to the warm or cold sites (**Fig. 16b**). 

Overall, the models explains less of the variance in the data deeper in the soil: 73%, 61%, and 56% for 0-10cm, 10-20cm, and 20-30cm, respectively (Table 1, Table 2, Table 3).

*NB in subsequent tables "ECO" = climate*

#### 0-10cm
>**Table `r {(tab.n <- 1)}`. ANOVA: Bulk soil, 0-10cm**

```{r models-blk-10-anova}
anova(blk.PMeco.10.lm)
```

#### 10-20cm
>**Table `r {(tab.n <- tab.n + 1)}`. ANOVA: Bulk soil, 10-20cm**

```{r models-blk-20-anova}
anova(blk.PMeco.20.lm)
```

#### 20-30cm
>**Table `r {(tab.n <- tab.n + 1)}`. ANOVA: Bulk soil, 20-30cm**

```{r models-blk-30-anova}
anova(blk.PMeco.30.lm)
```

### Respired CO~2~

The relative importance of parent material and climate for explaining the variance in $\Delta$^14^C-CO~2~ changes with depth in a similar manner as for bulk soil. Climate explains more of the variance in $\Delta$^14^C-CO~2~ at the surface (0-10cm) than does parent material (Table 4). Unlike bulk soil, however, parent material is not significant for $\Delta$^14^C-CO~2~ at the surface (*p* = ). Both parent material and climate are significant (*p* < 0.0005) for $\Delta$^14^C-CO~2~ at the 10-20cm depth, but parent material explains more variance than does climate (Table 5). At the deepest depth (20-30cm) climate is no longer a siginficant predictor of $\Delta$^14^C-CO~2~ at all, while parent material is strongly siginficant (*p* = 0.006) (Table 6). 

Year is highly significant for 0-10cm and 10-20cm (p < 0.0001), but not significant at 20-30cm (p = 0.0950). The two-way interaction between climate and year is significant at all depths, while the two-way interaction between parent material and year is siginficant below 10cm. 

We were able to explain more of the total variance in $\Delta$^14^C-CO~2~ than in bulk soil $\Delta$^14^C. The models explained a similar amount of variance in $\Delta$^14^C-CO~2~ at the 0-10cm and 10-20cm depths (R^2^ of 0.86 and 0.89, respectively), and had a similar amount of unexplained variance at 20-30cm (R^2^ = 0.70) as the model for bulk soil $\Delta$^14^C at the surface (R^2^ = 0.73).

#### 0-10cm
```{r models-inc-10-sum-con, include = FALSE}
# 0-10cm
inc.PMeco.10.lm <- lm(d14c ~ PM * ECO * year, sra.01.19.inc.d.10.df)
summary(inc.PMeco.10.lm)
inc.PMeco.10.et <- emtrends(inc.PMeco.10.lm, pairwise ~ PM * ECO, var = "year")
# ordered trends
# c(-6.2, -4.9, -3.9, -3.7, -3.1, -2.9, -2.3, -1.4, .1)

# 10-20
inc.PMeco.20.lm <- lm(d14c ~ PM * ECO * year, sra.01.19.inc.d.20.df)
summary(inc.PMeco.20.lm)
inc.PMeco.20.et <- emtrends(inc.PMeco.20.lm, pairwise ~ PM * ECO, var = "year")
# ordered trends
# c(-5.9, -4.3, -3.9, -2.2, -1.1, -1, -.8, 1.4, 4.8)

# 20-30
inc.PMeco.30.lm <- lm(d14c ~ PM * ECO * year, sra.01.19.inc.d.30.df)
summary(inc.PMeco.30.lm)
inc.PMeco.30.et <- emtrends(inc.PMeco.30.lm, pairwise ~ PM * ECO, var = "year")
# ordered trends
# c(-7.8, -3.5, -1.5, .1, .5, 1.4, 1.5, 2.8, 9.7)
```
>**Table `r {(tab.n <- tab.n + 1)}`. ANOVA: Respired CO~2~, 0-10cm**

```{r models-inc-10-anova}
anova(inc.PMeco.10.lm)
```

#### 10-20cm
>**Table `r {(tab.n <- tab.n + 1)}`. ANOVA: Respired CO~2~, 10-20cm**

```{r models-inc-20-anova}
anova(inc.PMeco.20.lm)
```

#### 20-30cm
>**Table `r {(tab.n <- tab.n + 1)}`. ANOVA: Respired CO~2~, 20-30cm**

```{r models-inc-30-anova}
anova(inc.PMeco.30.lm)
```

## Marginal mean trends: 2001-2019

The next set of plots show least-square mean estimates of trends and associated confidence intervals for each parent material, within climate groups, over the time period 2001 to 2019. Plots are shown for each depth increment. Raw data are shown as points.

Following each plot I show the contrasts for the slope estimates within parent material and climate groups. The first set of numbers show marginal means estimated within groups; second set of numbers show the contrasts, i.e. are the trends over time significantly different between different parent materials or climate conditions?

`r pagebreak()`

### Bulk soil
#### 0-10cm
##### Interaction plots
>**Fig. `r {(fig.n <- fig.n + 1)}`. Temporal trends in bulk soil $\Delta$^14^C by parent material (0-10cm)**

```{r plot-est-slopes-bulk-10-intPM}
# PM | ECO
emmip.plot.fx(lyr_bot = 10,
              Type = "Bulk",
              var = "PM",
              interact_var = "ECO")
```

```{r plot-est-slopes-bulk-10-intECO, include = FALSE}
# ECO | PM
emmip.plot.fx(lyr_bot = 10,
              Type = "Bulk",
              var = "ECO",
              interact_var = "PM")
```

We can see the strong effect of climate on the temporal trend in bulk soil $\Delta$^14^C clearly in Fig. `r {fig.n}`. Curves are much steeper at the warm site for all three parent materials, while they are nearly flat at the coldest site. However, at the cool site we can also see the effect of parent material within the climate grouping. The steepest slope and the most enriched $\Delta$^14^C is seen in the granite soils, while the andesite soils show no change in $\Delta$^14^C over time and are also much less enriched. Overall, rates of change in granite and basalt soils were not significantly different in any of the ecosystems. However, the andsite soils are changing significantly faster than the basalt soils at the warmest sites and significantly slower than the granite soils at the cool sites (Table 7).

For the andesite soils we see faster changes over time for the warm site relative to the cool and cold sites when considering the contrasts between climates within parent materials (*p* = 0.0006, and *p* = 0.0657 respectively) (Fig. `r {fig.n}`, Table 8). For the granite soils, however, we see significantly (*p* = 0.0105) faster rates of change at the cool sites than at either the warm or the cold sites.

```{r plot-est-slopes-bulk-10-PM, include = FALSE}
# PM
emmip.plot.fx(lyr_bot = 10,
              Type = "Bulk",
              var = "PM")
```

```{r plot-est-slopes-bulk-10-ECO, include = FALSE}
# ECO
emmip.plot.fx(lyr_bot = 10,
              Type = "Bulk",
              var = "ECO")
```

`r pagebreak()`
##### Trends & Contrasts
>**Table `r {(tab.n <- tab.n + 1)}`. Bulk soil, 0-10cm: Parent material trends within climate**

```{r trends-est-slopes-bulk-10-PMeco}
print("Interactions, PM | ECO")
emtrends(blk.PMeco.10.lm, pairwise ~ PM | ECO, var = "year")
```
`r pagebreak()`
>**Table `r {(tab.n <- tab.n + 1)}`. Bulk soil, 0-10cm: Climate trends within parent material**

```{r trends-est-slopes-bulk-10-ECOpm}
print("Interactions, ECO | PM")
emtrends(blk.PMeco.10.lm, pairwise ~ ECO | PM, var = "year")
```
`r pagebreak()`

#### 10-20cm
##### Interaction plots
>**Fig. `r {(fig.n <- fig.n + 1)}`. Temporal trends in bulk soil $\Delta$^14^C by parent material (10-20cm)** 

```{r plot-est-slopes-bulk-20-intPM}
# PM | ECO
emmip.plot.fx(lyr_bot = 20,
              Type = "Bulk",
              var = "PM",
              interact_var = "ECO")
```

```{r plot-est-slopes-bulk-20-intECO, include = FALSE}
# ECO | PM
emmip.plot.fx(lyr_bot = 20,
              Type = "Bulk",
              var = "ECO",
              interact_var = "PM")
```

text

```{r plot-est-slopes-bulk-20-PM, include = FALSE}
# PM
emmip.plot.fx(lyr_bot = 20,
              Type = "Bulk",
              var = "PM")
```
```{r plot-est-slopes-bulk-20-ECO, include = FALSE}
# ECO
emmip.plot.fx(lyr_bot = 20,
              Type = "Bulk",
              var = "ECO")
```
`r pagebreak()`

##### Trends & Contrasts
>**Table `r {(tab.n <- tab.n + 1)}`.  Bulk soil, 10-20cm: Parent material trends within climate**

```{r trends-est-slopes-bulk-20-PMeco}
print("Interactions, PM | ECO")
emtrends(blk.PMeco.20.lm, pairwise ~ PM | ECO, var = "year")
```
`r pagebreak()`
>**Table `r {(tab.n <- tab.n + 1)}`. Bulk soil, 10-20cm: Climate trends within parent material**

```{r trends-est-slopes-bulk-20-ECOpm}
print("Interactions, ECO | PM")
emtrends(blk.PMeco.20.lm, pairwise ~ ECO | PM, var = "year")
```

`r pagebreak()`
#### 20-30cm
##### Interaction plots
>**Fig. `r {(fig.n <- fig.n + 1)}`. Temporal trends in bulk soil $\Delta$^14^C by parent material (20-30cm)**

```{r plot-est-slopes-bulk-30-intPM}
# PM | ECO
emmip.plot.fx(lyr_bot = 30,
              Type = "Bulk",
              var = "PM",
              interact_var = "ECO")
```

```{r plot-est-slopes-bulk-30-intECO, include = FALSE}
# ECO | PM
emmip.plot.fx(lyr_bot = 30,
              Type = "Bulk",
              var = "ECO",
              interact_var = "PM")
```

text

```{r plot-est-slopes-bulk-30-PM, include = FALSE}
# PM
emmip.plot.fx(lyr_bot = 30,
              Type = "Bulk",
              var = "PM")
```
```{r plot-est-slopes-bulk-30-ECO, include = FALSE}
# ECO
emmip.plot.fx(lyr_bot = 30,
              Type = "Bulk",
              var = "ECO")
```
`r pagebreak()`

##### Trends & Contrasts
>**Table `r {(tab.n <- tab.n + 1)}`. Bulk soil, 20-30cm: Parent material trends within climate**

```{r trends-est-slopes-bulk-30-PMeco}
print("Interactions, PM | ECO")
emtrends(blk.PMeco.30.lm, pairwise ~ PM | ECO, var = "year")
```
`r pagebreak()`
>**Table `r {(tab.n <- tab.n + 1)}`. Bulk soil, 20-30cm: Climate trends within parent material**

```{r trends-est-slopes-bulk-30-ECOpm}
print("Interactions, ECO | PM")
emtrends(blk.PMeco.30.lm, pairwise ~ ECO | PM, var = "year")
```
`r pagebreak()`

### Respired CO~2~
#### 0-10cm
##### Interaction plots
>**Fig. `r {(fig.n <- fig.n + 1)}`. Temporal trends in respired $\Delta$^14^C-CO~2~ by parent material (0-10cm)**

```{r plot-est-slopes-inc-10-intPM}
# PM | ECO
emmip.plot.fx(lyr_bot = 10,
              Type = "Respired",
              var = "PM",
              interact_var = "ECO")
```

```{r plot-est-slopes-inc-10-intECO, include = FALSE}
# ECO | PM
emmip.plot.fx(lyr_bot = 10,
              Type = "Respired",
              var = "ECO",
              interact_var = "PM")
```

text

```{r plot-est-slopes-inc-10-PM, include = FALSE}
# shows data averaged across PM, ECO---not shown as all interactions highly significant
# PM
emmip.plot.fx(lyr_bot = 10,
              Type = "Respired",
              var = "PM")
```
```{r plot-est-slopes-inc-10-ECO, include = FALSE}
# ECO
emmip.plot.fx(lyr_bot = 10,
              Type = "Respired",
              var = "ECO")
```
`r pagebreak()`
##### Trends & Contrasts
>**Table `r {(tab.n <- tab.n + 1)}`. Respired  CO~2~, 0-10cm: Parent material trends within climate**

```{r trends-est-slopes-inc-10}
print("Interactions, PM | ECO")
emtrends(inc.PMeco.10.lm, pairwise ~ PM | ECO, var = "year")
```
`r pagebreak()`
>**Table `r {(tab.n <- tab.n + 1)}`. Respired  CO~2~, 0-10cm: Climate trends within parent material**

```{r}
print("Interactions, ECO | PM")
emtrends(inc.PMeco.10.lm, pairwise ~ ECO | PM, var = "year")
```
`r pagebreak()`

#### 10-20cm
##### Interaction plots
>**Fig. `r {(fig.n <- fig.n + 1)}`. Temporal trends in respired $\Delta$^14^C-CO~2~ by parent material (10-20cm)**

```{r plot-est-slopes-inc-20-intPM}
# PM | ECO
emmip.plot.fx(lyr_bot = 20,
              Type = "Respired",
              var = "PM",
              interact_var = "ECO")
```

```{r plot-est-slopes-inc-20-intECO, include = FALSE}
# ECO | PM
emmip.plot.fx(lyr_bot = 20,
              Type = "Respired",
              var = "ECO",
              interact_var = "PM")
```

text

```{r plot-est-slopes-inc-20-PM, include = FALSE}
# PM
emmip.plot.fx(lyr_bot = 20,
              Type = "Respired",
              var = "PM")
```
```{r plot-est-slopes-inc-20-ECO, include = FALSE}
# ECO
emmip.plot.fx(lyr_bot = 20,
              Type = "Respired",
              var = "ECO")
```
`r pagebreak()`
##### Trends & Contrasts
>**Table `r {(tab.n <- tab.n + 1)}`. Respired  CO~2~, 10-20cm: Parent material trends within climate**

```{r trends-est-slopes-inc-20-PMeco}
print("Interactions, PM | ECO")
emtrends(inc.PMeco.20.lm, pairwise ~ PM | ECO, var = "year")
```
`r pagebreak()`
>**Table `r {(tab.n <- tab.n + 1)}`. Respired  CO~2~, 10-20cm: Climate trends within parent material**

```{r trends-est-slopes-inc-20-ECOpm}
print("Interactions, ECO | PM")
emtrends(inc.PMeco.20.lm, pairwise ~ ECO | PM, var = "year")
```
`r pagebreak()`

#### 20-30cm
##### Interaction plots
>**Fig. `r {(fig.n <- fig.n + 1)}`. Temporal trends in respired $\Delta$^14^C-CO~2~ by parent material (20-30cm)**

```{r plot-est-slopes-inc-30-intPM}
# PM | ECO
emmip.plot.fx(lyr_bot = 30,
              Type = "Respired",
              var = "PM",
              interact_var = "ECO")
```

```{r plot-est-slopes-inc-30-intECO, include = FALSE}
# ECO | PM
emmip.plot.fx(lyr_bot = 30,
              Type = "Respired",
              var = "ECO",
              interact_var = "PM")
```

text

```{r plot-est-slopes-inc-30-PM, include = FALSE}
# PM
emmip.plot.fx(lyr_bot = 30,
              Type = "Respired",
              var = "PM")
```
```{r plot-est-slopes-inc-30-ECO, include = FALSE}
# ECO
emmip.plot.fx(lyr_bot = 30,
              Type = "Respired",
              var = "ECO")
```
`r pagebreak()`

##### Trends & Contrasts
>**Table `r {(tab.n <- tab.n + 1)}`. Respired  CO~2~, 20-30cm: Parent material trends within climate**

```{r trends-est-slopes-inc-30-PMeco}
print("Interactions, PM | ECO")
emtrends(inc.PMeco.30.lm, pairwise ~ PM | ECO, var = "year")
```
`r pagebreak()`
>**Table `r {(tab.n <- tab.n + 1)}`. Respired  CO~2~, 20-30cm: Climate trends within parent material**

```{r trends-est-slopes-inc-30-ECOpm}
print("Interactions, ECO | PM")
emtrends(inc.PMeco.30.lm, pairwise ~ ECO | PM, var = "year")
```

`r pagebreak()`
## Interactions with mineral assemblages

The amount and persistence of soil organic matter found in association with soil minerals varies depending on the physical and chemical properties of the minerals present. While we can infer differences in soil mineral assemblages from parent material, selective dissolution of iron and aluminum provides a quantitative measure of the crystalline and poorly crystalline minerals thought to be most important in protecting soil organic matter from decomposition. These extractions also give insight into how mineral assemblages change over geologic time through weathering. We compared selective dissolution data from our sites (Rasmussen et al. 2018) to the radiocarbon measured in bulk soils and heterotrophically respired CO~2~ (this study) in order to assess the relationship between mineral assemblage and potential mineral protection of soil C.

Oxalate extracts poorly crystalline (short range ordered, SRO) iron oxyhydroxides, e.g. ferrihydrite, as well as SRO aluminosilicates, e.g. allophane and imogolite (Parfitt and Childs, 1988). These minerals have high surface area and variable charge that facilitates the formation of strong innersphere bonds with soil organic matter. The SRO minerals are additionally characterised by a high degree of hydration and are able bind to soil organic matter through both electrostatic attraction and surface complexation (Berhe et al., 2012). Extraction of iron with the dithionite-citrate reagent dissolves poorly crystalline minerals as well as crystalline minerals such as goethite and hematite (Parfitt and Childs, 1988). The crystalline minerals are also capable of binding soil organic matter, but have smaller specific surface area than the poorly crystalline minerals (Kaiser and Guggenberger, 2003). Finally, sodium pyrophosphate specifically targets aluminum in complexed forms, including organo-mineral complexes linked by cation bridging (Ellerbrock and Kaiser, 2005). The carbon extracted by this reagent has been shown to be more enriched in ^14^C than the "heavy" fraction obtained from density fractionation, suggesting that soil organic matter held in these complexes is exchanged more rapidly with the atmosphere, i.e. more vulnerable to decomposition, than C in other types of mineral organic associations (Heckman et al. 2018).

In addition to bulk and respired ^14^C alone, we also looked at the difference in $\Delta$^14^C between bulk soil and heterotrophically respired CO~2~, and how this difference was related to the concentration of extracted metals. The magnitude of this difference is an indicator for the presence of persistent soil C pools that are inaccessible to the microbial community. This has important implications for modeling soil carbon dynamics, because it can be used to determine whether or not the system can be effectively modeled as a single homogenous pool of carbon, as well as giving insight into potential mechanisms of soil C persistence. 

We observed that the bulk-respired ^14^C difference increased with greater concentrations of extractable iron and aluminum. Trends are clearest for the oxalate extracts (Fe and Al), although all extracts show a significant trend. In general, granite soils had the lowest concentrations of extractable Fe and Al for all reagents, while andesite soils had the highest. For climate, the coolest sites had the highest concentrations, while the warm sites had the lowest, with the exception of dithionite Fe.

We observed that bulk $\Delta$^14^C was more depleted with increasing concentrations of extractable Fe and Al in both 2001 and 2019. Respired $\Delta$^14^C-CO~2~ data measured in 2019 showed the same trend, although the slope was less steep than for the bulk soil $\Delta$^14^C relationship. However, the 2001 respired $\Delta$^14^C-CO~2~ data showed no consistent trend in respired $\Delta$^14^C-CO~2~ in relation to the concentration of extractable Al or Fe.
  
```{r plot-min-14c-lyr, include = FALSE}
# load data
load("sra.all.min.RData")

# create bulk.sd, inc.sd, 
sra.all.min$d14c_bulk.sd <- sra.all.min$d14c_bulk - sra.all.min$d14c_u_bulk
sra.all.min$d14c_inc.sd <- sra.all.min$d14c_inc - sra.all.min$d14c_u_inc

# min plot fx
min.plot.fx <- function(df, C14, C14err) {
  quo_C14 <- sym(C14)
  quo_C14err <- sym(C14err)
  ylab <- ifelse(C14 == "d14c_bulk", expression('Bulk '*Delta*''^14*'C (‰)'), ifelse(C14 == "d14c_inc", expression('Respired '*Delta*''^14*'C (‰)'), expression('Bulk - Respired '*Delta*''^14*'C (‰)')))
  ggplot(df, aes(conc, !! quo_C14)) +
  geom_point(aes(color = pm, shape = ecoYear, size = depth)) +
  geom_errorbar(
    aes(ymin = !! quo_C14 - !! quo_C14err,
        ymax = !! quo_C14 + !! quo_C14err,
        color = pm,
        width = width)) +
  scale_color_manual(name = "Parent material",
                     values = c("andesite" = andesite,
                                "basalt" = basalt,
                                "granite" = granite)) +
  scale_shape_manual(name = "Climate (year)",
                     values = c("warm (2001)" = 15, 
                                "cool (2001)" = 17, 
                                "cold (2001)" = 16,
                                "warm (2019)" = 0, 
                                "cool (2019)" = 2, 
                                "cold (2019)" = 1)) +
  scale_size_manual(name = "Depth",
                    values = (3:5)) +
  facet_wrap(vars(min), scales = "free") +
  ylab(ylab) +
  xlab(expression('Concentration (g kg'^-1*')')) +
  theme_bw() +
  theme(panel.grid.minor = element_blank())
}

# Plot all mins vs. bulk
sra.all.min %>%
  mutate(pmEcoDepth = paste0(pm, eco, lyr_bot),
         ecoYear = paste0(eco, " (", year, ")"),
         width = ifelse(min == "Al_py" | min == "Fe_ox", .3, 1.5)) %>%
  filter(pmEcoDepth != "granitecold30" & pmEcoDepth != "granitecold20") %>%
  min.plot.fx(., "d14c_bulk", "d14c_bulk.sd")

# Plot all mins vs. respired
sra.all.min %>%
  mutate(pmEcoDepth = paste0(pm, eco, lyr_bot),
         ecoYear = paste0(eco, " (", year, ")"),
         width = ifelse(min == "Al_py" | min == "Fe_ox", .3, 1.5)) %>%
  filter(pmEcoDepth != "granitecold30" & pmEcoDepth != "granitecold20") %>%
  min.plot.fx(., "d14c_inc", "d14c_inc.sd")

# Plot all mins vs. blk-inc
sra.all.min %>%
  mutate(pmEcoDepth = paste0(pm, eco, lyr_bot),
         ecoYear = paste0(eco, " (", year, ")"),
         width = ifelse(min == "Al_py" | min == "Fe_ox", .3, 1.5)) %>%
  filter(pmEcoDepth != "granitecold30" & pmEcoDepth != "granitecold20") %>%
  min.plot.fx(., "blk.inc", "blk.inc.sd")

# Fe_dc alone
# warm
sra.all.min %>%
  filter(eco == "warm" & min == "Fe_dc") %>%
  mutate(ecoYear = paste0(eco, " (", year, ")"),
         width = 1.5) %>%
  min.plot.fx(., "blk.inc", "blk.inc.sd")

# cool + cold
sra.all.min %>%
  filter(eco != "warm" & min == "Fe_dc") %>%
  mutate(pmEcoDepth = paste0(pm, eco, lyr_bot),
         ecoYear = paste0(eco, " (", year, ")"),
         width = 1.5) %>%
  filter(pmEcoDepth != "granitecold30" & pmEcoDepth != "granitecold20") %>%
  min.plot.fx(., "blk.inc", "blk.inc.sd")
```

### Mineral assemblage and ^14^C plots
#### 0-30cm
>**Fig. `r {(fig.n <- fig.n + 1)}`. Relationship between $\Delta$^14^C and extractable Fe and Al. Points show mass-weighted mean of mineral concentrations and carbon-weighted means of $\Delta$^14^C for the 0-30cm depth increment**
>**^a)^ Bulk soil $\Delta$^14^C - respired $\Delta$^14^C-CO~2~**

```{r plot-min-14c-0-30-blk-inc}
## 0-30cm data
load("sra.all.30.min.RData")
load("sra.all.30.min.conc.wtd.RData")
# plot fx for 0-30cm data
min.plot.30.fx <- function(df, C14, C14err, min_var) {
  quo_min <- sym(min_var)
  quo_C14 <- sym(C14)
  quo_C14err <- sym(C14err)
  ylab <- ifelse(C14 == "d14c_mean_blk", expression('Bulk '*Delta*''^14*'C (‰)'), ifelse(C14 == "d14c_mean_inc", expression('Respired '*Delta*''^14*'C (‰)'), expression('Bulk - Respired '*Delta*''^14*'C (‰)')))
  xlab <- ifelse(min_var == "min_stock_cmtv", expression('Mineral stock (kg m'^-2*')'), expression('Mineral concentration (g kg'^-2*')'))
  ggplot(df, aes(!! quo_min, !! quo_C14)) +
    geom_hline(yintercept = 0, color = "darkgray") +
    geom_point(aes(color = pm, shape = ecoYear), size = 3) +
    geom_errorbar(
      aes(ymin = !! quo_C14 - !! quo_C14err,
          ymax = !! quo_C14 + !! quo_C14err,
          color = pm,
          width = width)) +
    scale_color_manual(name = "Parent material",
                       values = c("andesite" = andesite,
                                  "basalt" = basalt,
                                  "granite" = granite)) +
    scale_shape_manual(name = "Climate (year)",
                       values = c("warm (2001)" = 15, 
                                  "cool (2001)" = 17, 
                                  "cold (2001)" = 16,
                                  "warm (2019)" = 0, 
                                  "cool (2019)" = 2, 
                                  "cold (2019)" = 1)) +
    facet_wrap(vars(min), scales = "free") +
    ylab(ylab) +
    xlab(xlab) +
    theme_bw() +
    theme(panel.grid.minor = element_blank())
}

# cumulative mineral stocks
# sra.all.30.min %>%
#   mutate(pmEcoDepth = paste0(pm, eco),
#          ecoYear = paste0(eco, " (", year, ")"),
#          width = ifelse(min == "Al_py" | min == "Fe_ox", .09, .7)) %>%
#   # filter(pmEcoDepth != "granitecold30" & pmEcoDepth != "granitecold20") %>%
#   min.plot.30.fx(., "d14c_mean_blk", "d14c_sd_blk", "min_stock_cmtv")
# sra.all.30.min %>%
#   mutate(pmEco = paste0(pm, eco),
#          ecoYear = paste0(eco, " (", year, ")"),
#          width = ifelse(min == "Al_py" | min == "Fe_ox", .09, .7)) %>%
#   filter(pmEco != "granitecold" & pmEco != "granitecold") %>%
#   min.plot.30.fx(., "d14c_mean_inc", "d14c_sd_inc", "min_stock_cmtv")
# sra.all.30.min %>%
#   mutate(pmEco = paste0(pm, eco),
#          ecoYear = paste0(eco, " (", year, ")"),
#          width = ifelse(min == "Al_py" | min == "Fe_ox", .09, .7)) %>%
#   filter(pmEco != "granitecold" & pmEco != "granitecold") %>%
#   min.plot.30.fx(., "blk.inc", "blk.inc.sd", "min_stock_cmtv")

# Plot 0-30cm mass and C weighted data
# bulk - inc
sra.all.30.min.conc.wtd %>%
  mutate(pmEco = paste0(pm, eco),
         ecoYear = paste0(eco, " (", year, ")"),
         width = ifelse(min == "Al_py" | min == "Fe_ox", .2, 1)) %>%
  filter(pmEco != "granitecold") %>%
  min.plot.30.fx(., "blk.inc", "blk.inc.sd", "conc")

# Fe_dc alone
# # warm
# sra.all.30.min.conc.wtd %>%
#   filter(eco == "warm" & min == "Fe_dc") %>%
#   mutate(ecoYear = paste0(eco, " (", year, ")"),
#          width = 1.5) %>%
#   min.plot.30.fx(., "blk.inc", "blk.inc.sd", "conc")
# 
# # cool + cold
# sra.all.30.min.conc.wtd %>%
#   filter(eco != "warm" & min == "Fe_dc") %>%
#   mutate(pmEco = paste0(pm, eco),
#          ecoYear = paste0(eco, " (", year, ")"),
#          width = .2) %>%
#   filter(pmEco != "granitecold") %>%
#   min.plot.30.fx(., "blk.inc", "blk.inc.sd", "conc")

# plot all min data by MAT
# sra.all.30.min.conc.wtd %>% mutate(MAT = ifelse(eco == "cold", 4, ifelse(eco == "cool", 8, 13))) %>% ggplot(., aes(MAT, conc, color = pm)) + geom_line() + geom_point(aes(shape = eco), size = 3) + scale_shape_manual(values = c("cold" = 16, "cool" = 17, "warm" = 15)) + scale_color_manual(values = c("andesite" = andesite, "basalt" = basalt, "granite" = granite)) + facet_grid(vars(min), scales="free") + theme_bw() + theme(panel.grid.minor = element_blank())
```

>**^b)^ Bulk soil $\Delta$^14^C**

```{r plot-blk-min-0-30-blk}
# bulk 0-30cm
sra.all.30.min.conc.wtd %>%
  mutate(pmEco = paste0(pm, eco),
         ecoYear = paste0(eco, " (", year, ")"),
         width = ifelse(min == "Al_py" | min == "Fe_ox", .2, 1)) %>%
  filter(pmEco != "granitecold") %>%
  min.plot.30.fx(., "d14c_mean_blk", "d14c_sd_blk", "conc")
```

>**^c)^ Respired soil $\Delta$^14^C-CO~2~**

```{r plot-blk-min-0-30-inc}
# inc 0-30cm
sra.all.30.min.conc.wtd %>%
  mutate(pmEco = paste0(pm, eco),
         ecoYear = paste0(eco, " (", year, ")"),
         width = ifelse(min == "Al_py" | min == "Fe_ox", .2, 1)) %>%
  filter(pmEco != "granitecold") %>%
  min.plot.30.fx(., "d14c_mean_inc", "d14c_sd_inc", "conc")
```

```{r min-stats, include = FALSE}
# reshape sra.all.min wider
sra.all.min2 <- sra.all.min %>%
  pivot_wider(names_from = min, values_from = conc)

# 2001
corrplot(cor(sra.all.min2[sra.all.min2$year == 2001, c(3,5,7,11,14:17)]), 
         method = "number", type = "lower")
# 2019
corrplot(cor(sra.all.min2[sra.all.min2$year == 2019, c(3,5,7,11,14:17)]), 
         method = "number", type = "lower")

# 2001 & 2019
corrplot(cor(sra.all.min2[ , c(3,5,7,11,14:17)]), 
         method = "number", type = "lower")

# 2019 "cool"
corrplot(cor(sra.all.min2[sra.all.min2$year == 2019 & sra.all.min2$eco == "cool", c(3,5,7,11,14:17)]), 
         method = "number", type = "lower")

# 2019 "cold"
corrplot(cor(sra.all.min2[sra.all.min2$year == 2019 & sra.all.min2$eco == "cold", c(3,5,7,11,14:17)]), 
         method = "number", type = "lower")

# 2019 "warm"
corrplot(cor(sra.all.min2[sra.all.min2$year == 2019 & sra.all.min2$eco == "warm", c(3,5,7,11,14:17)]), 
         method = "number", type = "lower")

## linear models
# dif (uses means; could use all combos...?)
sra.all.30.min.conc.wtd.wide <- sra.all.30.min.conc.wtd %>%
  filter(PMeco != "GRrf") %>%
  pivot_wider(names_from = min, values_from = conc)
# NB: year not significant as additive or interaction term
summary(lm(blk.inc ~ Al_ox, sra.all.30.min.conc.wtd.wide)) # R2 = 0.49, p = 0.0015
summary(lm(blk.inc ~ Al_py, sra.all.30.min.conc.wtd.wide)) # R2 = 0.55, p = 0.0006
summary(lm(blk.inc ~ Fe_ox, sra.all.30.min.conc.wtd.wide)) # R2 = 0.53, p = 0.0008
summary(lm(blk.inc ~ Fe_dc, sra.all.30.min.conc.wtd.wide)) # ns
summary(lm(blk.inc ~ Fe_dc, sra.all.30.min.conc.wtd.wide[sra.all.30.min.conc.wtd.wide$eco != "warm", ])) 
# R2 = 0.47, p = 0.017
sra.all.30.min.conc.wtd.wide %>%
  mutate(FeCrys = Fe_dc - Fe_ox) %>%
  lm(blk.inc ~ FeCrys, .) %>%
  summary()

# reps
load("sra.blk.inc.rep.30.df.RData")
sra.blk.inc.rep.min.30.df <- merge(
  sra.blk.inc.rep.30.df,
  sra.all.30.min.conc.wtd[sra.all.30.min.conc.wtd$year == 2001, c("PMeco", "min", "conc")] %>%
    pivot_wider(names_from = min, values_from = conc)) %>%
  mutate(Year = factor(year))
# bulk
summary(lm(d14c_blk ~ Al_ox + Year, sra.blk.inc.rep.min.30.df))
summary(lm(d14c_blk ~ Al_py + Year, sra.blk.inc.rep.min.30.df))
summary(lm(d14c_blk ~ Fe_ox + Year, sra.blk.inc.rep.min.30.df))
summary(lm(d14c_blk ~ Fe_dc + Year, 
           sra.blk.inc.rep.min.30.df[-grep("pp", sra.blk.inc.rep.min.30.df$PMeco), ]))

# inc 
# NB: 1) no Fe_dc due to GRrf issues
#     2) Year interaction sig. for Al_py, Fe_ox; 2001 slope flat for those mins
summary(lm(d14c_inc ~ Al_ox + Year, sra.blk.inc.rep.min.30.df[sra.blk.inc.rep.min.30.df$PMeco != "GRrf", ])) # R2 = 0.68, p < 0.0001
summary(lm(d14c_inc ~ Al_py * Year, sra.blk.inc.rep.min.30.df[sra.blk.inc.rep.min.30.df$PMeco != "GRrf", ])) # R2 = 0.69, p < 0.0001
summary(lm(d14c_inc ~ Fe_ox * Year, sra.blk.inc.rep.min.30.df[sra.blk.inc.rep.min.30.df$PMeco != "GRrf", ])) # R2 = 0.68, p < 0.0001

# plot reps (bulk, inc)
blk.inc.min.30.plot.fx <- function(df, d14c_var, 
                                   min_in = NULL,
                                   min_out = NULL,
                                   eco_in = NULL,
                                   eco_out = NULL,
                                   PMeco_filter = NULL) {
  d14c_quo <- sym(d14c_var)
  plot.df <- sra.blk.inc.rep.min.30.df %>%
    pivot_longer(cols = c(Al_ox, Al_py, Fe_ox, Fe_dc), names_to = "min", values_to = "conc") %>%
    mutate(ECO = substr(PMeco, 3, 4),
           PM = substr(PMeco, 1, 2)) %>%
    mutate(eco = factor(ifelse(ECO == "pp", "warm",
                               ifelse(ECO == "wf", "cool", "cold")),
                        levels = c("warm", "cool", "cold")),
           pm = ifelse(PM == "AN", "andesite",
                       ifelse(PM == "BS", "basalt", "granite"))) %>%
    mutate(ecoYear = paste0(eco, " (", Year, ")"))
  if (!is.null(min_in)) {
    plot.df <- plot.df %>%
      filter(min == min_in)
  }
  if (!is.null(min_out)) {
    plot.df <- plot.df %>%
      filter(min != min_out)
  }
  if (!is.null(eco_in)) {
    plot.df <- plot.df %>%
      filter(eco == eco_in)
  }
  if (!is.null(eco_out)) {
    plot.df <- plot.df %>%
      filter(eco != eco_out)
    }
  if (!is.null(PMeco_filter)) {
    plot.df <- plot.df %>%
      filter(PMeco != PMeco_filter)
  }
  ggplot(plot.df, aes(conc, !! d14c_quo)) +
    geom_hline(yintercept = 0, color = "darkgray") +
    geom_smooth(method = "lm", formula = y ~ x, se = FALSE, 
                aes(linetype = Year), color = "black") +
    geom_point(aes(color = pm, shape = ecoYear), size = 3) +
    scale_color_manual(name = "Parent material",
                       values = c("andesite" = andesite,
                                  "basalt" = basalt,
                                  "granite" = granite)) +
    scale_shape_manual(name = "Climate (year)",
                       values = c("warm (2001)" = 15, 
                                  "cool (2001)" = 17, 
                                  "cold (2001)" = 16,
                                  "warm (2019)" = 0, 
                                  "cool (2019)" = 2, 
                                  "cold (2019)" = 1)) +
    facet_wrap(vars(min), nrow = 3, ncol = 2, scales = "free") +
    theme_bw() +
    theme(panel.grid = element_blank()) 
}
  
# plot
blk.inc.min.30.plot.fx(sra.blk.inc.rep.min.30.df, d14c_var = "d14c_blk",
                       min_out = "Fe_dc")
blk.inc.min.30.plot.fx(sra.blk.inc.rep.min.30.df, d14c_var = "d14c_blk",
                       min_in = "Fe_dc", eco_out = "warm")
blk.inc.min.30.plot.fx(sra.blk.inc.rep.min.30.df, d14c_var = "d14c_blk",
                       min_in = "Fe_dc", eco_in = "warm")
blk.inc.min.30.plot.fx(sra.blk.inc.rep.min.30.df, d14c_var = "d14c_inc",
                       min_out = "Fe_dc", PMeco_filter = "GRrf")
```

```{r change-14c-time-mins-plot, include = FALSE}
## change over time vs. min
# # 0-30cm data
# sra.all.30.min.conc.wtd.wide2 <- merge(
#   sra.all.30.min.conc.wtd.wide[sra.all.30.min.conc.wtd.wide$year == 2001, c(1, 3, 5, 11:14)],
#   sra.all.30.min.conc.wtd.wide[sra.all.30.min.conc.wtd.wide$year == 2019, c(1, 3, 5)], 
#   by = "PMeco", suffixes = c("_01", "_19")) %>%
#   mutate(d14c_blk_d = d14c_mean_blk_01 - d14c_mean_blk_19,
#          d14c_inc_d = d14c_mean_inc_01 - d14c_mean_inc_19)

# # bulk
# sra.19.01.d.min <- left_join(
#   sra.19.01.d[ , c("lyr_bot", "PM", "ECO", "dd14c_01_19", "sd14c_01_19")], 
#   ras18.sp.df[ , c("Al_ox", "Al_py", "Fe_dc", "Fe_ox", "lyr_bot", "PM", "ECO")], 
#   by = c("lyr_bot", "PM", "ECO")) 
# sra.19.01.d.min2 <- sra.19.01.d.min %>%
#   pivot_longer(cols = c("Al_py", "Al_ox", "Fe_ox", "Fe_dc"), names_to = "min", values_to = "conc")
# 
# # corr
# corrplot(cor(sra.19.01.d.min[ , c(1,4:9)]), method = "number")
# 
# # min vs. d/t
# sra.19.01.d.min2 %>%
#   filter(lyr_bot == 20) %>%
#   mutate(eco = factor(ifelse(ECO == "pp", "warm",
#                       ifelse(ECO == "wf", "cool", "cold")),
#                       levels = c("warm", "cool", "cold")),
#          pm = ifelse(PM == "AN", "andesite",
#                      ifelse(PM == "BS", "basalt", "granite")),
#          width = ifelse(min == "Al_py" | min == "Fe_ox", .3, 1.5)) %>%
#   ggplot(., aes(conc, dd14c_01_19)) +
#   geom_point(aes(color = pm, shape = eco), size = 3) +
#   geom_errorbar(
#     aes(ymin = dd14c_01_19 - sd14c_01_19,
#         ymax = dd14c_01_19 + sd14c_01_19,
#         color = pm,
#         width = width)) +
#   scale_color_manual(name = "Parent material",
#                      values = c("andesite" = andesite,
#                                 "basalt" = basalt,
#                                 "granite" = granite)) +
#   scale_shape_manual(name = "Climate",
#                      values = c("warm" = 15, 
#                                 "cool" = 16, 
#                                 "cold" = 17)) +
#   facet_wrap(vars(min), scales = "free") +
#   ylab(expression('Change in bulk soil '*Delta*''^14*'C (‰) 2019-2001')) +
#   xlab(expression('Concentration (g kg'^-1*')')) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank())
# 
# # inc
# sra.19.01.inc.d.min.df <- left_join(
#   sra.19.01.inc.d.df[ , c("lyr_bot", "PM", "ECO", "dd14c_01_19", "sd14c_01_19")], 
#   ras18.sp.df[ , c("Al_ox", "Al_py", "Fe_dc", "Fe_ox", "lyr_bot", "PM", "ECO")], 
#   by = c("lyr_bot", "PM", "ECO"))
# sra.19.01.inc.d.min.df2 <- sra.19.01.inc.d.min.df %>%
#   pivot_longer(cols = c("Al_py", "Al_ox", "Fe_ox", "Fe_dc"), names_to = "min", values_to = "conc")
# 
# # corr
# corrplot(cor(sra.19.01.inc.d.min.df[ , c(1,4:9)]), method = "number")
# 
# # min vs. d/t
# sra.19.01.inc.d.min.df %>%
#   filter(lyr_bot == 30) %>%
#   mutate(pmeco = paste0(PM, ECO),
#          eco = factor(ifelse(ECO == "pp", "warm",
#                       ifelse(ECO == "wf", "cool", "cold")),
#                       levels = c("warm", "cool", "cold")),
#          pm = ifelse(PM == "AN", "andesite",
#                      ifelse(PM == "BS", "basalt", "granite")),
#          width = ifelse(min == "Al_py" | min == "Fe_ox", .3, 1.5)) %>%
#   filter(pmeco != "GRrf") %>%
#   ggplot(., aes(conc, dd14c_01_19)) +
#   geom_point(aes(color = pm, shape = eco), size = 3) +
#   geom_errorbar(
#     aes(ymin = dd14c_01_19 - sd14c_01_19,
#         ymax = dd14c_01_19 + sd14c_01_19,
#         color = pm,
#         width = width)) +
#   scale_color_manual(name = "Parent material",
#                      values = c("andesite" = andesite,
#                                 "basalt" = basalt,
#                                 "granite" = granite)) +
#   scale_shape_manual(name = "Climate",
#                      values = c("warm" = 15, 
#                                 "cool" = 16, 
#                                 "cold" = 17)) +
#   facet_wrap(vars(min), scales = "free") +
#   ylab(expression('Change in respired '*Delta*''^14*'C (‰) 2019-2001')) +
#   xlab(expression('Concentration (g kg'^-1*')')) +
#   theme_bw() +
#   theme(panel.grid.minor = element_blank())
```